<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>TDV - Transfer Drafting Views | DB Tools </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="TDV - Transfer Drafting Views | DB Tools ">
      
      
      <link rel="icon" href="../../../images/favicon.ico">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css?v=20260125">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/kirsch33/dbtools/blob/dev/wiki/developer-guide/tools/common/tdv.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        localStorage.setItem('theme', 'dark')
        document.documentElement.setAttribute('data-bs-theme', 'dark')
      </script>

      <script src="../../../public/main.js?v=20260125" defer></script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" src="../../../images/logo.png" alt="DB Tools" width="32" height="32">
            DB Tools
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="tdv---transfer-drafting-views">TDV - Transfer Drafting Views</h1>

<p>TDV (Transfer Drafting Views) is a tool for importing and exporting drafting views between Revit documents and a central library. It enables teams to maintain a shared collection of standard drafting views that can be distributed across projects.</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/manifest.yml:1-45</code></p>
</blockquote>
<h2 id="overview">Overview</h2>
<p>TDV provides two primary operations:</p>
<ol>
<li><strong>Export to Library</strong> - Copy drafting views from the active document to a central library file</li>
<li><strong>Import from Library</strong> - Copy drafting views from a library file to the active document</li>
</ol>
<p>The tool handles worksharing, creates local copies for edits, and synchronizes changes back to the central library file after export operations.</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvExportCommand.cs:18-27</code></p>
</blockquote>
<h2 id="features">Features</h2>
<h3 id="core-capabilities">Core Capabilities</h3>
<ul>
<li><strong>Bi-directional transfer</strong> - Import and export drafting views between documents</li>
<li><strong>View type mapping</strong> - Map source view types to destination view types, or retain original type</li>
<li><strong>Conflict detection</strong> - Real-time detection of naming conflicts with existing views</li>
<li><strong>Replace mode</strong> - Option to replace existing views with the same name</li>
<li><strong>Preview panel</strong> - Live preview of selected drafting views with pan/zoom support</li>
<li><strong>Batch transfer</strong> - Transfer multiple views in a single operation</li>
<li><strong>Transaction grouping</strong> - All transfers wrapped in a transaction group for atomicity</li>
<li><strong>Progress tracking</strong> - Per-view progress feedback during transfer operations</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvService.cs:106-330</code></p>
</blockquote>
<h3 id="crash-hardening-2026-02-07">Crash Hardening (2026-02-07)</h3>
<p>The TDV import/export apply path was hardened after a Revit 2026 hard-crash investigation:</p>
<ul>
<li><strong>Destination-bound transactions</strong> - The transfer group and per-view transactions are now started against the explicit destination <code>Document</code>, not implicitly against <code>ActiveUIDocument</code>.</li>
<li><strong>Cross-document safety checks</strong> - TDV now validates that source/destination contexts are valid live documents and not the same document.</li>
<li><strong>Transfer run diagnostics</strong> - Transfer start logs include run id plus source/destination title and path to improve post-crash forensics.</li>
<li><strong>Non-activating library open</strong> - TDV now opens library files with <code>Application.OpenDocumentFile(...)</code> (no activate) so the host model stays active during transfer and cleanup.</li>
<li><strong>Cleanup-safe close path</strong> - TDV commands now use best-effort close (<code>TryCloseAsync</code>) for library cleanup to prevent cleanup-only close failures from surfacing as command failure banners.</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvService.cs:106-372</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvDocumentService.cs:186-246</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvDocumentService.cs:137-168</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvImportCommand.cs:120-130</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvExportCommand.cs:143-168</code>
<strong>Source:</strong> <code>src/DBTools.Core/Revit/Transactions/ITransactionGroupService.cs:5-18</code>
<strong>Source:</strong> <code>src/DBTools.Core/Revit/Transactions/CallGateTransactionGroupService.cs:99-280</code></p>
</blockquote>
<h3 id="library-management">Library Management</h3>
<ul>
<li><strong>Multiple library files</strong> - Configure multiple library files with fallback paths</li>
<li><strong>Path validation</strong> - Automatic validation of library file accessibility</li>
<li><strong>Local copy workflow</strong> - Creates local copies from central files for worksharing</li>
<li><strong>Automatic sync</strong> - Syncs changes back to central after export with detailed comments</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvDocumentService.cs:26-126</code></p>
</blockquote>
<h3 id="view-transfer-details">View Transfer Details</h3>
<p>When transferring views, TDV:</p>
<ol>
<li>Creates or prepares the destination view with the selected view type</li>
<li>Copies the view scale and description parameters</li>
<li>Copies all elements from the source view (excluding viewports, title blocks, schedules, etc.)</li>
<li>Copies element graphic overrides from source to destination</li>
</ol>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvOps.cs:145-189</code></p>
</blockquote>
<h3 id="view-type-resolution-rules">View Type Resolution Rules</h3>
<p>The row <code>View Type</code> combobox is destination-scoped for the active transfer direction:</p>
<ul>
<li><strong>Import</strong> (<code>library -&gt; host</code>): combobox options are drafting view types from the host document.</li>
<li><strong>Export</strong> (<code>host -&gt; library</code>): combobox options are drafting view types from the library document.</li>
</ul>
<p><code>Retain Original</code> always resolves to the source view's drafting type name for that row. If that type name is missing in the destination document, TDV creates it by duplicating an existing destination drafting <code>ViewFamilyType</code> and renaming the duplicate.</p>
<p>If source type name resolution fails, TDV records a per-view <code>SourceTypeNameUnavailable</code> error and does not silently fall back.</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvService.cs:47-95</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvService.cs:186-213</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvOps.cs:52-99</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvOps.cs:233-277</code></p>
</blockquote>
<h2 id="architecture">Architecture</h2>
<p>TDV follows the MVVM pattern with a clean separation between UI, business logic, and Revit API operations.</p>
<h3 id="project-structure">Project Structure</h3>
<pre><code>src/Tools/Common/TDV/
├── Bootstrap/               # DI registration
├── Contracts/               # Interfaces and DTOs
├── DesignTime/              # Design-time view models
├── Features/                # Command implementations
├── Properties/              # Design-time resources
├── Revit/Services/          # Revit API operations
├── Settings/                # Configuration models
├── Tests/                   # Unit tests
└── UI/
    ├── ViewModels/          # MVVM view models
    └── Views/               # WPF views
</code></pre>
<h3 id="service-registration">Service Registration</h3>
<p>Services are registered as scoped to properly handle Revit's run-scope dependencies:</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Bootstrap/TdvServiceExtensions.cs:11-33</code></p>
</blockquote>
<pre><code class="lang-csharp">services.AddScoped&lt;ITdvTransferService&gt;(sp =&gt;
    new TdvService(gate, tx, groups, logger));
services.AddScoped&lt;ITdvLibraryService&gt;(sp =&gt;
    new TdvLibraryService(settings, RevitInstanceIdentifier.RevitYear));
services.AddScoped&lt;ITdvDocumentService, TdvDocumentService&gt;();
</code></pre>
<h3 id="key-interfaces">Key Interfaces</h3>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Implementation</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ITdvTransferService</code></td>
<td><code>TdvService</code></td>
<td>Core transfer operations</td>
</tr>
<tr>
<td><code>ITdvLibraryService</code></td>
<td><code>TdvLibraryService</code></td>
<td>Library path management</td>
</tr>
<tr>
<td><code>ITdvDocumentService</code></td>
<td><code>TdvDocumentService</code></td>
<td>Document open/close/sync</td>
</tr>
<tr>
<td><code>ITdvContext</code></td>
<td><code>TdvService.RevitTdvContext</code></td>
<td>Abstraction over Revit Document</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Contracts/ITdvTransferService.cs:1-23</code></p>
</blockquote>
<h3 id="transfer-service-operations">Transfer Service Operations</h3>
<p>The <code>ITdvTransferService</code> interface defines:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BuildViewItemsAsync</code></td>
<td>Collects drafting views from source document</td>
</tr>
<tr>
<td><code>ApplySelectionAsync</code></td>
<td>Executes the transfer operation</td>
</tr>
<tr>
<td><code>WouldConflictAsync</code></td>
<td>Checks for naming conflicts</td>
</tr>
<tr>
<td><code>ExportPreviewAsync</code></td>
<td>Generates preview image for a view</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Contracts/ITdvTransferService.cs:6-22</code></p>
</blockquote>
<h2 id="ui-components">UI Components</h2>
<h3 id="main-window-tdvwindow">Main Window (<code>TdvWindow</code>)</h3>
<p>The main transfer window provides:</p>
<ul>
<li><strong>Filter controls</strong> - Filter by view type and search by name</li>
<li><strong>Data grid</strong> - Lists all drafting views with transfer options</li>
<li><strong>Preview panel</strong> - Shows selected view with pan/zoom</li>
<li><strong>Status bar</strong> - Displays selection counts and transfer results</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/UI/Views/TdvWindow.xaml:1-537</code></p>
</blockquote>
<p>The TDV window now binds its overlay instance to itself (<code>ProgressOverlayService.For(this)</code>), ensuring overlay ownership and dispatcher affinity are tied to the active TDV host window.</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/UI/Views/TdvWindow.xaml.cs:59-74</code></p>
</blockquote>
<h3 id="viewmodel-tdvwindowviewmodel">ViewModel (<code>TdvWindowViewModel</code>)</h3>
<p>Key properties and commands:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Items</code></td>
<td><code>ObservableCollection&lt;TdvViewItem&gt;</code></td>
<td>Filtered list of views</td>
</tr>
<tr>
<td><code>Search</code></td>
<td><code>string</code></td>
<td>Search filter text</td>
</tr>
<tr>
<td><code>SelectedViewTypeFilter</code></td>
<td><code>string</code></td>
<td>View type filter</td>
</tr>
<tr>
<td><code>SelectedItem</code></td>
<td><code>TdvViewItem</code></td>
<td>Currently selected view</td>
</tr>
<tr>
<td><code>PreviewSource</code></td>
<td><code>ImageSource</code></td>
<td>Preview image</td>
</tr>
<tr>
<td><code>HasAnyConflict</code></td>
<td><code>bool</code></td>
<td>Indicates naming conflicts</td>
</tr>
<tr>
<td><code>Status</code></td>
<td><code>string</code></td>
<td>Status bar text</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ApplySelectionCommand</code></td>
<td>Executes the transfer</td>
</tr>
<tr>
<td><code>ClearSelectedCommand</code></td>
<td>Clears all selections</td>
</tr>
<tr>
<td><code>ClearSearchCommand</code></td>
<td>Clears search filter</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/UI/ViewModels/TdvWindowViewModel.cs:22-409</code></p>
</blockquote>
<h3 id="view-item-tdvviewitem">View Item (<code>TdvViewItem</code>)</h3>
<p>Represents a single drafting view in the UI:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SourceViewId</code></td>
<td><code>int</code></td>
<td>Revit element ID</td>
</tr>
<tr>
<td><code>ViewName</code></td>
<td><code>string</code></td>
<td>Editable view name</td>
</tr>
<tr>
<td><code>ViewType</code></td>
<td><code>string</code></td>
<td>Selected destination type</td>
</tr>
<tr>
<td><code>ViewTypeName</code></td>
<td><code>string</code></td>
<td>Original source type name</td>
</tr>
<tr>
<td><code>Checked</code></td>
<td><code>bool</code></td>
<td>Selected for transfer</td>
</tr>
<tr>
<td><code>Replace</code></td>
<td><code>bool</code></td>
<td>Replace if exists</td>
</tr>
<tr>
<td><code>HasConflict</code></td>
<td><code>bool</code></td>
<td>Has naming conflict</td>
</tr>
<tr>
<td><code>HasTypeWarning</code></td>
<td><code>bool</code></td>
<td>Source type unavailable</td>
</tr>
<tr>
<td><code>RowState</code></td>
<td><code>string</code></td>
<td>Transfer status (pending/success/failure)</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/UI/ViewModels/TdvViewItem.cs:9-106</code></p>
</blockquote>
<h3 id="preview-features">Preview Features</h3>
<p>The preview panel supports:</p>
<ul>
<li><strong>Debounced loading</strong> - 200ms debounce prevents excessive exports</li>
<li><strong>LRU cache</strong> - Caches up to 32 preview images</li>
<li><strong>Pan and zoom</strong> - Interactive image manipulation via <code>ImagePanZoomBehavior</code></li>
<li><strong>Dark theme background</strong> - Consistent preview appearance (RGB: 43, 44, 61)</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/UI/ViewModels/TdvWindowViewModel.cs:74-81</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvOps.cs:19-28</code></p>
</blockquote>
<h2 id="settings-configuration">Settings Configuration</h2>
<h3 id="library-settings">Library Settings</h3>
<p>TDV uses the <code>MasterLibrarySettings</code> class to store library file configurations:</p>
<pre><code class="lang-csharp">public sealed class MasterLibrarySettings
{
    public IList&lt;LibraryFileEntry&gt; Files { get; set; }
    public bool HasWarnings { get; set; }
}

public sealed class LibraryFileEntry
{
    public string? MainPath { get; set; }
    public string? FallbackPath { get; set; }
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Settings/MasterLibrarySettings.cs:1-8</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Settings/LibraryFileEntry.cs:1-8</code></p>
</blockquote>
<p>Each library entry supports:</p>
<ul>
<li><strong>Main path</strong> - Primary path to the library RVT file</li>
<li><strong>Fallback path</strong> - Alternative path (e.g., for different network locations)</li>
</ul>
<h3 id="settings-pack">Settings Pack</h3>
<p>The <code>LibrarySettingsPackContext</code> provides the settings UI with:</p>
<ul>
<li>Tree-based library file management</li>
<li>Add/remove library files</li>
<li>Add/remove fallback paths</li>
<li>Real-time path validation</li>
<li>Pending changes tracking</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Settings/LibrarySettingsPackContext.cs:19-352</code></p>
</blockquote>
<h3 id="settings-path-presentation">Settings Path Presentation</h3>
<p>Library paths in settings are rendered with:</p>
<ul>
<li>Validation icon at the left of each tree row (green check / red error)</li>
<li>Tooltip showing the full absolute path</li>
<li>Compact display text that keeps root + filename + the final 3 folder levels</li>
</ul>
<p>This avoids horizontal scrolling while preserving useful location context.</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Settings/LibrarySettingsPackView.xaml:33-77</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Settings/LibrarySettingsPackContext.cs:296-313</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Settings/LibraryPathDisplayFormatter.cs:1-63</code></p>
</blockquote>
<h3 id="path-validation">Path Validation</h3>
<p>Library paths are validated for:</p>
<ul>
<li>File existence</li>
<li><code>.rvt</code> extension</li>
<li>Revit version compatibility (file's saved version must match the current Revit session)</li>
<li>Accessibility</li>
</ul>
<p>Invalid paths trigger a settings warning that disables the import/export commands.</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvLibraryService.cs:100-160</code></p>
</blockquote>
<h3 id="revit-version-validation">Revit Version Validation</h3>
<p>Library files are checked at two points to prevent version mismatches:</p>
<ol>
<li><p><strong>Validation time</strong> (<code>TdvLibraryService.ValidatePath</code>): Uses <code>BasicFileInfo.Extract()</code> and <code>RevitInstanceIdentifier.ParseRevitYear()</code> to compare the file's saved Revit version against the current session. Mismatched files are marked invalid with a descriptive failure reason and excluded from the accessible library list.</p>
</li>
<li><p><strong>Open time</strong> (<code>TdvDocumentService.OpenLibraryAsync</code>): A belt-and-suspenders check before opening. Throws <code>InvalidOperationException</code> if the file version doesn't match, which is caught by the command's try/catch and displayed as a banner.</p>
</li>
</ol>
<p>This prevents two dangerous scenarios:</p>
<ul>
<li><strong>Workshared files</strong>: <code>WorksharingUtils.CreateNewLocal()</code> would throw a version mismatch error at open time</li>
<li><strong>Non-workshared files</strong>: Revit would silently upgrade the file, which is destructive</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvLibraryService.cs:135-155</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvDocumentService.cs:30-45</code></p>
</blockquote>
<h3 id="dialog-suppression-during-document-open">Dialog Suppression During Document Open</h3>
<p>When opening a library document, the TDV commands wrap the <code>OpenLibraryAsync</code> call with <code>DialogSuppressionHook.SuppressAvailabilityDialogs()</code>. This suppresses cascading Revit &quot;availability command failed&quot; TaskDialogs (<code>TaskDialog_External_Tools_Command_Failure</code>) that can occur during document switching when Revit re-evaluates <code>IExternalCommandAvailability</code> checks.</p>
<p>The suppression uses a scoped pattern mechanism: a regex pattern is pushed onto a thread-safe stack and automatically removed when the <code>using</code> scope ends.</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Services/DialogSuppression/DialogSuppressionHook.cs</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvImportCommand.cs:92-101</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvExportCommand.cs:96-105</code></p>
</blockquote>
<h2 id="manifest-configuration">Manifest Configuration</h2>
<p>The tool is configured via <code>manifest.yml</code>:</p>
<pre><code class="lang-yaml">id: DBTools.TDV
assembly: DBTools
moduleType: DBTools.TDV.TdvToolModule
order: 0

sandboxWindows:
  - id: DBTools.TDV.Main
    displayName: &quot;Transfer Drafting Views&quot;
    group: &quot;Common&quot;
    windowType: &quot;DBTools.TDV.UI.Views.TdvWindow&quot;

tool:
  settings:
    configSection: Core.MasterLibrary
  settingsPacks:
    - key: core.library
      title: &quot;Library Files&quot;
      warnings:
        - id: core.library.invalid
          title: &quot;Library Paths Invalid&quot;
          message: &quot;One or more library file paths are invalid...&quot;
          disableTools:
            - DBTools.ExportToLibrary
            - DBTools.ImportFromLibrary

  ribbonTools:
    - internalName: DBTools.ExportToLibrary
      commandType: DBTools.TDV.Features.TdvExportCommand
      availabilityType: DBTools.App.Tools.Availability.DbtDocumentAvailability
      runProfile: InlineUi
      displayText: &quot;Export\nTo Library&quot;
      iconBaseKey: export
      tooltip: &quot;Export drafting views to the library&quot;
      controlKind: StackedButtonItem
      splitGroup: library_transfer

    - internalName: DBTools.ImportFromLibrary
      commandType: DBTools.TDV.Features.TdvImportCommand
      availabilityType: DBTools.App.Tools.Availability.DbtDocumentAvailability
      runProfile: InlineUi
      displayText: &quot;Import\nFrom Library&quot;
      iconBaseKey: import
      tooltip: &quot;Import drafting views from the library&quot;
      controlKind: StackedButtonItem
      splitGroup: library_transfer
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/manifest.yml:1-45</code></p>
</blockquote>
<h3 id="ribbon-configuration">Ribbon Configuration</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Export</th>
<th>Import</th>
</tr>
</thead>
<tbody>
<tr>
<td>Internal Name</td>
<td><code>DBTools.ExportToLibrary</code></td>
<td><code>DBTools.ImportFromLibrary</code></td>
</tr>
<tr>
<td>Command</td>
<td><code>TdvExportCommand</code></td>
<td><code>TdvImportCommand</code></td>
</tr>
<tr>
<td>Run Profile</td>
<td><code>InlineUi</code></td>
<td><code>InlineUi</code></td>
</tr>
<tr>
<td>Icon</td>
<td><code>export</code></td>
<td><code>import</code></td>
</tr>
<tr>
<td>Control Kind</td>
<td><code>StackedButtonItem</code></td>
<td><code>StackedButtonItem</code></td>
</tr>
<tr>
<td>Split Group</td>
<td><code>library_transfer</code></td>
<td><code>library_transfer</code></td>
</tr>
</tbody>
</table>
<h2 id="error-handling">Error Handling</h2>
<h3 id="per-view-error-codes">Per-View Error Codes</h3>
<p>Transfer failures are categorized by error code:</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Unknown</code></td>
<td>Unspecified error</td>
</tr>
<tr>
<td><code>DestinationTypeMissing</code></td>
<td>Target view type not found</td>
</tr>
<tr>
<td><code>SourceTypeNameUnavailable</code></td>
<td>Cannot read source view type</td>
</tr>
<tr>
<td><code>CreateViewFailed</code></td>
<td>Failed to create destination view</td>
</tr>
<tr>
<td><code>CopyElementsFailed</code></td>
<td>Failed to copy view elements</td>
</tr>
<tr>
<td><code>OverridesFailed</code></td>
<td>Failed to copy graphic overrides</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Contracts/TdvPerViewErrorCode.cs:1-12</code></p>
</blockquote>
<h3 id="error-reporting">Error Reporting</h3>
<p>After each transfer attempt, TDV now always surfaces result UX:</p>
<ul>
<li><strong>Top banner</strong> on the TDV window (<code>success</code>/<code>warning</code>) with selected/processed/result counts</li>
<li><strong>Summary alert</strong> with:
<ul>
<li>Selected, processed, added, replaced, and error counts</li>
<li>Optional per-view issue table when failures exist</li>
<li>Action buttons: <strong>Accept and Transfer More</strong> and <strong>Close Tool</strong></li>
<li>Copy-to-clipboard for per-view issue rows</li>
</ul>
</li>
</ul>
<p>TDV also records and surfaces selection accountability:</p>
<ul>
<li>Transfer logs now include selected view identifiers/names (bounded preview)</li>
<li>Result payload includes <code>SelectedCount</code>, <code>ProcessedCount</code>, and <code>Cancelled</code></li>
<li>UI warns when selected/processed counts diverge</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/UI/Views/TdvWindow.xaml.cs:111-231</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/UI/ViewModels/TdvWindowViewModel.cs:274-348</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Contracts/TdvApplySelectionResult.cs:5-13</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvService.cs:125-372</code></p>
</blockquote>
<h2 id="revit-api-operations">Revit API Operations</h2>
<h3 id="getting-drafting-views">Getting Drafting Views</h3>
<pre><code class="lang-csharp">new FilteredElementCollector(doc)
    .OfClass(typeof(View))
    .WhereElementIsNotElementType()
    .Cast&lt;View&gt;()
    .Where(v =&gt; v.ViewType == ViewType.DraftingView &amp;&amp; !v.IsTemplate)
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvOps.cs:30-39</code></p>
</blockquote>
<h3 id="copying-view-contents">Copying View Contents</h3>
<p>Elements are copied using <code>ElementTransformUtils.CopyElements</code> with a custom <code>IDuplicateTypeNamesHandler</code> that uses destination types when duplicates are found.</p>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvOps.cs:145-162</code></p>
</blockquote>
<h3 id="skipped-categories">Skipped Categories</h3>
<p>The following categories are excluded from copy operations:</p>
<ul>
<li>Title Blocks</li>
<li>Viewports</li>
<li>Views</li>
<li>Schedules</li>
<li>Guide Grids</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Revit/Services/TdvOps.cs:13-16</code></p>
</blockquote>
<h2 id="command-reference">Command Reference</h2>
<h3 id="library-selection-dialog-sizing">Library Selection Dialog Sizing</h3>
<p>TDV export/import library selection dialogs override default alert dimensions to a compact tool-specific size:</p>
<ul>
<li>Width: <code>760</code></li>
<li>Height: <code>440</code></li>
<li>MinWidth: <code>520</code></li>
<li>MinHeight: <code>340</code></li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvAlertWindowOptions.cs:1-17</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvExportCommand.cs:75-84</code>
<strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvImportCommand.cs:70-79</code></p>
</blockquote>
<h3 id="export-command-flow">Export Command Flow</h3>
<ol>
<li>Validate library paths are configured</li>
<li>Prompt user to select a library file</li>
<li>Create local copy of central library file</li>
<li>Open library document</li>
<li>Show TdvWindow for view selection</li>
<li>Execute transfer to library</li>
<li>Sync changes to central with comment</li>
<li>Close library and reactivate original document</li>
</ol>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvExportCommand.cs:31-137</code></p>
</blockquote>
<h3 id="import-command-flow">Import Command Flow</h3>
<ol>
<li>Validate library paths are configured</li>
<li>Prompt user to select a library file</li>
<li>Create local copy of central library file</li>
<li>Open library document</li>
<li>Show TdvWindow for view selection</li>
<li>Execute transfer to active document</li>
<li>Close library (no sync needed)</li>
</ol>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Features/TdvImportCommand.cs:27-107</code></p>
</blockquote>
<h2 id="cross-references">Cross-References</h2>
<ul>
<li><a href="../../architecture/overview.html">Architecture Overview</a> - Application architecture patterns</li>
<li><a href="../../projects/app.html">App Project</a> - Main application and tool hosting</li>
</ul>
<h2 id="testing">Testing</h2>
<p>TDV includes unit tests for:</p>
<ul>
<li><code>TdvViewItem</code> - View model behavior</li>
<li><code>TdvLibraryService</code> - Path validation and library management</li>
<li><code>TdvAdapter</code> - Service adapter tests</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>src/Tools/Common/TDV/Tests/</code></p>
</blockquote>
<hr>
<p><em>Last updated: February 2026</em></p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/kirsch33/dbtools/blob/dev/wiki/developer-guide/tools/common/tdv.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          DB Tools - Revit Add-in Toolkit
        </div>
      </div>
    </footer>
  </body>
</html>
