<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>DBTools.Sandbox | DB Tools </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="DBTools.Sandbox | DB Tools ">
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css?v=20260125">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/kirsch33/dbtools/blob/dev/csharp/wiki/developer-guide/projects/sandbox.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        localStorage.setItem('theme', 'dark')
        document.documentElement.setAttribute('data-bs-theme', 'dark')
      </script>

      <script src="../../public/main.js?v=20260125" defer></script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" src="../../images/logo.png" alt="DB Tools" width="32" height="32">
            DB Tools
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="dbtoolssandbox">DBTools.Sandbox</h1>

<p>The <strong>DBTools.Sandbox</strong> project is a standalone WPF application that enables development, testing, and validation of DBTools UI windows <strong>without running Revit</strong>. It provides both an interactive gallery for browsing tool windows and a headless validation mode used during CI builds.</p>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/DBTools.Sandbox.csproj:1-54</code></p>
</blockquote>
<h2 id="overview">Overview</h2>
<h3 id="purpose">Purpose</h3>
<p>Sandbox exists to solve a fundamental Revit development challenge: tool UI windows normally require Revit to be running, which makes iterative UI development slow and makes CI validation difficult. Sandbox provides:</p>
<ol>
<li><strong>Interactive Development</strong>: Launch tool windows with design-time ViewModels to preview UI without Revit</li>
<li><strong>Build-Time Validation</strong>: Catch XAML errors, missing resources, and binding failures during CI</li>
<li><strong>Screenshot Capture</strong>: Generate UI screenshots for documentation or visual regression testing</li>
</ol>
<h3 id="key-concepts">Key Concepts</h3>
<ul>
<li><strong>Design-Time ViewModels</strong>: Each sandbox-enabled window must provide a ViewModel that works without Revit services</li>
<li><strong>Sandbox Mode</strong>: A global flag (<code>SandboxMode.IsActive</code>) that windows check to avoid calling Revit-dependent code</li>
<li><strong>Dist-Driven Discovery</strong>: Sandbox loads windows from the built <code>dist/</code> payload, validating the actual shipped assemblies</li>
</ul>
<h2 id="project-structure">Project Structure</h2>
<pre><code>csharp/src/DBTools.Sandbox/
├── App.xaml.cs                      # Application entry, mode switching
├── MainWindow.xaml.cs               # Interactive gallery window
├── SandboxAppRuntime.cs             # IAppRuntime implementation for sandbox
├── SandboxDiagnostics.cs            # Logging utilities
├── SandboxSettingsProvider.cs       # Settings stub for sandbox mode
├── HeadlessUiSuppression.cs         # Suppresses OS dialogs in CI
└── Validation/
    ├── DistValidator.cs             # Main validation orchestrator
    ├── ToolWindowValidator.cs       # Tool window instantiation/layout
    ├── ManifestValidator.cs         # Manifest schema validation
    ├── WindowGhostValidator.cs      # WPF layout pass validation
    ├── MergeValidator.cs            # ILRepack/embedded payload checks
    ├── BindingErrorListener.cs      # WPF binding error capture
    ├── SandboxValidateOptions.cs    # CLI argument parsing
    ├── SandboxModeActivator.cs      # Cross-assembly mode activation
    ├── SandboxScreenshotHandler.cs  # Screenshot capture mode
    ├── DistDirLocator.cs            # Dist directory resolution
    ├── DistAssemblyResolver.cs      # Assembly loading for dist payload
    ├── RevitDirLocator.cs           # Revit installation discovery
    ├── DistValidationReflection.cs  # Reflection helpers
    ├── AssemblyMetadataInspector.cs # PE metadata inspection
    └── XamlExceptionDiagnostics.cs  # XAML error formatting
</code></pre>
<h2 id="operating-modes">Operating Modes</h2>
<h3 id="interactive-mode-default">Interactive Mode (Default)</h3>
<p>Launch the sandbox gallery to browse and open tool windows:</p>
<pre><code class="lang-bash"># From csharp/.artifacts/sandbox/Release/net8.0-windows/
DBTools.Sandbox.exe
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/App.xaml.cs:109-137</code></p>
</blockquote>
<p>The interactive mode:</p>
<ol>
<li>Initializes <code>SandboxAppRuntime</code> for service resolution</li>
<li>Loads <code>DBTools.dll</code> from the dist payload</li>
<li>Discovers all <code>sandboxWindows</code> from tool manifests</li>
<li>Displays a grouped gallery of launchable windows</li>
</ol>
<h3 id="headless-validation-mode">Headless Validation Mode</h3>
<p>Used by the build system to validate dist output:</p>
<pre><code class="lang-bash">DBTools.Sandbox.exe --headless --dist-dir &quot;path/to/dist/Release/2026&quot;
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/App.xaml.cs:45-57</code></p>
</blockquote>
<p>Headless mode performs comprehensive validation without showing any UI:</p>
<ul>
<li>Theme resource validation</li>
<li>Core window instantiation</li>
<li>Tool manifest validation</li>
<li>Tool window XAML validation</li>
<li>WPF binding error detection</li>
</ul>
<h3 id="screenshot-mode">Screenshot Mode</h3>
<p>Capture window screenshots for documentation:</p>
<pre><code class="lang-bash"># List available tools
DBTools.Sandbox.exe --screenshot --list

# Capture specific tool
DBTools.Sandbox.exe --screenshot --tool-id DBTools.GM.Main --output gm.png
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/SandboxScreenshotHandler.cs:24-49</code></p>
</blockquote>
<h2 id="key-components">Key Components</h2>
<h3 id="sandboxappruntime">SandboxAppRuntime</h3>
<p>Minimal <code>IAppRuntime</code> implementation that provides essential services without Revit:</p>
<pre><code class="lang-csharp">internal sealed class SandboxAppRuntime : IAppRuntime, IDisposable
{
    // Provides: ILogger, ISettingsProvider, ILoggerFactory, IAlertService
    public T Resolve&lt;T&gt;() where T : notnull { ... }
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/SandboxAppRuntime.cs:17-90</code></p>
</blockquote>
<p>Services provided:</p>
<ul>
<li><code>IDbtLoggingHost</code> - Real logging to <code>%APPDATA%/DBTools/Logs/dbtools-SANDBOX-*.log</code></li>
<li><code>ISettingsProvider</code> - Stub implementation returning defaults</li>
<li><code>ILoggerFactory</code> - Creates category-scoped loggers</li>
<li><code>IAlertService</code> - Real alert service for error display</li>
</ul>
<h3 id="sandboxmode">SandboxMode</h3>
<p>Global flag that windows check to avoid Revit-dependent code paths:</p>
<pre><code class="lang-csharp">public static class SandboxMode
{
    public static bool IsActive =&gt; _isActive;
    public static void Activate() { _isActive = true; }
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Core/Compat/SandboxMode.cs:1-24</code></p>
</blockquote>
<p>Windows should check this before calling Revit services:</p>
<pre><code class="lang-csharp">if (!SandboxMode.IsActive)
{
    // Call Revit-dependent code
}
</code></pre>
<h3 id="dbtsandboxcatalog">DbtSandboxCatalog</h3>
<p>Discovers sandbox windows from tool manifests:</p>
<pre><code class="lang-csharp">public static IReadOnlyList&lt;DbtSandboxWindowSpec&gt; Discover(Assembly rootAssembly)
{
    var entries = DbtToolManifestLoader.LoadEntries(rootAssembly);
    // Extract sandboxWindows from each manifest
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Core/Tools/DbtSandboxCatalog.cs:8-60</code></p>
</blockquote>
<p>Validates that each sandbox window entry has:</p>
<ul>
<li><code>id</code> - Unique identifier</li>
<li><code>displayName</code> - Human-readable name</li>
<li><code>group</code> - Category for gallery grouping</li>
<li><code>windowType</code> - Fully-qualified Window class name</li>
<li><code>designTimeViewModelType</code> - ViewModel for sandbox mode</li>
</ul>
<h2 id="tool-manifest-integration">Tool Manifest Integration</h2>
<p>Tools register sandbox windows via <code>manifest.yml</code>:</p>
<pre><code class="lang-yaml">id: DBTools.GM
assembly: DBTools
moduleType: DBTools.GM.GmToolModule
sandboxWindows:
  - id: DBTools.GM.Main
    displayName: &quot;Global Mapper&quot;
    group: &quot;Common&quot;
    windowType: &quot;DBTools.GM.Shell.UI.Views.GmWindow&quot;
    designTimeViewModelType: &quot;DBTools.GM.Shell.DesignTime.GmShellDesignTimeViewModel&quot;
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/Tools/Common/GM/manifest.yml:1-15</code></p>
</blockquote>
<h3 id="schema-fields">Schema Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Yes</td>
<td>Unique window identifier (e.g., <code>DBTools.GM.Main</code>)</td>
</tr>
<tr>
<td><code>displayName</code></td>
<td>Yes</td>
<td>Gallery display name</td>
</tr>
<tr>
<td><code>group</code></td>
<td>Yes</td>
<td>Gallery category grouping</td>
</tr>
<tr>
<td><code>windowType</code></td>
<td>Yes</td>
<td>Fully-qualified Window type name</td>
</tr>
<tr>
<td><code>designTimeViewModelType</code></td>
<td>Yes</td>
<td>Design-time ViewModel type</td>
</tr>
<tr>
<td><code>assembly</code></td>
<td>No</td>
<td>Assembly name (defaults to manifest's <code>assembly</code>)</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Core/Tools/DbtToolManifestLoader.cs:121-153</code></p>
</blockquote>
<h2 id="validation-system">Validation System</h2>
<p>The validation system runs during <code>BuildAll</code> to catch UI issues before deployment.</p>
<h3 id="distvalidator-orchestrator">DistValidator (Orchestrator)</h3>
<p>Main validation entry point that coordinates all validators:</p>
<pre><code class="lang-csharp">internal static class DistValidator
{
    public static int Run(SandboxValidateOptions options, ILogger? logger = null)
    {
        // 1. Validate dist layout
        // 2. Install assembly resolver
        // 3. Validate theme resources
        // 4. Validate core windows
        // 5. Validate manifests (optional)
        // 6. Validate tool windows (optional)
    }
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/DistValidator.cs:15-118</code></p>
</blockquote>
<h3 id="toolwindowvalidator">ToolWindowValidator</h3>
<p>Instantiates each sandbox window with its design-time ViewModel:</p>
<pre><code class="lang-csharp">internal static class ToolWindowValidator
{
    public static void ValidateOrThrow(Assembly dbtoolsAssembly, ILogger? logger = null)
    {
        var specs = DiscoverSpecs(dbtoolsAssembly);
        foreach (var spec in specs)
        {
            // 1. Load window type from assembly
            // 2. Create window instance
            // 3. Create design-time ViewModel
            // 4. Set DataContext
            // 5. Run WindowGhostValidator
            // 6. Validate tab interactions
            // 7. Validate row expansion
        }
    }
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/ToolWindowValidator.cs:13-173</code></p>
</blockquote>
<p>Additional validations performed:</p>
<ul>
<li><strong>Tab cycling</strong> - Switches through all tabs to catch transition errors</li>
<li><strong>DataGrid row expansion</strong> - Toggles row details visibility</li>
<li><strong>Preview mode switching</strong> - Tests mode transitions (e.g., SGT preview modes)</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/ToolWindowValidator.cs:201-368</code></p>
</blockquote>
<h3 id="windowghostvalidator">WindowGhostValidator</h3>
<p>Forces WPF layout passes to catch XAML errors:</p>
<pre><code class="lang-csharp">internal static class WindowGhostValidator
{
    public static void Validate(Window window)
    {
        // Pass 1: Fixed 800x600 size
        ValidateLayoutPass(window, new Size(800, 600), &quot;fixed size&quot;);
        
        // Pass 2: Infinite size (catches DesiredSize calculation errors)
        ValidateLayoutPass(window, new Size(PositiveInfinity, PositiveInfinity), &quot;infinite size&quot;);
    }
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/WindowGhostValidator.cs:9-129</code></p>
</blockquote>
<h3 id="bindingerrorlistener">BindingErrorListener</h3>
<p>Captures WPF binding errors that normally fail silently:</p>
<pre><code class="lang-csharp">internal sealed class BindingErrorListener : TraceListener
{
    // Hooks into PresentationTraceSources.DataBindingSource
    // Collects &quot;System.Windows.Data Error:&quot; messages
    // ThrowIfErrors() fails validation if any binding errors occurred
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/BindingErrorListener.cs:13-118</code></p>
</blockquote>
<p>This catches issues like:</p>
<ul>
<li>Missing <code>StaticResource</code> references</li>
<li>Broken binding paths</li>
<li>Type conversion failures</li>
</ul>
<h3 id="mergevalidator">MergeValidator</h3>
<p>Validates assembly merge/embedding is correct:</p>
<p><strong>For net48 (ILRepack):</strong></p>
<ul>
<li>Verifies expected types exist inside <code>DBTools.dll</code></li>
<li>Ensures merged assemblies don't exist as separate files</li>
</ul>
<p><strong>For net8 (Embedded Payload):</strong></p>
<ul>
<li>Verifies <code>DBTools.EmbeddedAssemblies.DBTools.Core.dll</code> resource exists</li>
<li>Checks resource isn't corrupted (minimum size validation)</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/MergeValidator.cs:17-222</code></p>
</blockquote>
<h2 id="cli-arguments">CLI Arguments</h2>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--headless</code></td>
<td>Run validation only, no UI</td>
</tr>
<tr>
<td><code>--screenshot</code></td>
<td>Run screenshot capture mode</td>
</tr>
<tr>
<td><code>--dist-dir &lt;path&gt;</code></td>
<td>Path to dist directory or year folder</td>
</tr>
<tr>
<td><code>--revit-dir &lt;path&gt;</code></td>
<td>Override Revit installation path</td>
</tr>
<tr>
<td><code>--validate-manifests</code></td>
<td>Enable manifest validation (default: true)</td>
</tr>
<tr>
<td><code>--skip-validate-manifests</code></td>
<td>Disable manifest validation</td>
</tr>
<tr>
<td><code>--validate-tools</code></td>
<td>Enable tool window validation (default: true)</td>
</tr>
<tr>
<td><code>--skip-validate-tools</code></td>
<td>Disable tool window validation</td>
</tr>
<tr>
<td><code>--list</code></td>
<td>List available tools (screenshot mode)</td>
</tr>
<tr>
<td><code>--tool-id &lt;id&gt;</code></td>
<td>Tool to capture (screenshot mode)</td>
</tr>
<tr>
<td><code>--output &lt;path&gt;</code></td>
<td>Screenshot output path</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/SandboxValidateOptions.cs:7-113</code></p>
</blockquote>
<h2 id="build-integration">Build Integration</h2>
<p>The sandbox validator is invoked automatically during <code>BuildAll</code>:</p>
<pre><code class="lang-bash">bash csharp/build.sh BuildAll
# Internally runs: DBTools.Sandbox.exe --headless --dist-dir ...
</code></pre>
<p>The build system also handles orphaned processes:</p>
<pre><code class="lang-csharp">static void KillOrphanedSandboxValidatorProcesses()
{
    // Kills any lingering DBTools.Sandbox processes from previous builds
}
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/build/BuildTargets.cs:1292</code></p>
</blockquote>
<h2 id="creating-a-sandbox-enabled-window">Creating a Sandbox-Enabled Window</h2>
<h3 id="1-create-design-time-viewmodel">1. Create Design-Time ViewModel</h3>
<pre><code class="lang-csharp">public class MyWindowDesignTimeViewModel : INotifyPropertyChanged
{
    public MyWindowDesignTimeViewModel()
    {
        // Initialize with sample data
        Items = new ObservableCollection&lt;ItemModel&gt;
        {
            new ItemModel { Name = &quot;Sample 1&quot; },
            new ItemModel { Name = &quot;Sample 2&quot; }
        };
    }
    
    public ObservableCollection&lt;ItemModel&gt; Items { get; }
}
</code></pre>
<h3 id="2-add-parameterless-constructor-to-window">2. Add Parameterless Constructor to Window</h3>
<pre><code class="lang-csharp">public partial class MyWindow : Window
{
    // Required for sandbox mode
    public MyWindow()
    {
        InitializeComponent();
        if (SandboxMode.IsActive)
        {
            // Skip Revit-dependent initialization
            return;
        }
        // Normal initialization...
    }
}
</code></pre>
<h3 id="3-register-in-manifestyml">3. Register in manifest.yml</h3>
<pre><code class="lang-yaml">sandboxWindows:
  - id: MyTool.Main
    displayName: &quot;My Tool Window&quot;
    group: &quot;Common&quot;
    windowType: &quot;MyNamespace.UI.Views.MyWindow&quot;
    designTimeViewModelType: &quot;MyNamespace.DesignTime.MyWindowDesignTimeViewModel&quot;
</code></pre>
<h3 id="4-test-locally">4. Test Locally</h3>
<pre><code class="lang-bash"># Build
bash csharp/build.sh BuildAll

# Launch interactive sandbox
csharp/.artifacts/sandbox/Release/net8.0-windows/DBTools.Sandbox.exe
</code></pre>
<h2 id="multi-framework-support">Multi-Framework Support</h2>
<p>Sandbox targets both <code>net48</code> and <code>net8.0-windows</code> to validate both Revit 2024 (net48) and Revit 2025+ (net8) distributions:</p>
<pre><code class="lang-xml">&lt;TargetFrameworks&gt;$(DBT_RevitTargetFrameworks)&lt;/TargetFrameworks&gt;
</code></pre>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/DBTools.Sandbox.csproj:3</code></p>
</blockquote>
<p>The validator automatically selects the compatible year folder:</p>
<ul>
<li>net48 sandbox validates Revit 2024 (<code>year &lt;= 2024</code>)</li>
<li>net8 sandbox validates Revit 2025+ (<code>year &gt;= 2025</code>)</li>
</ul>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/Validation/DistDirLocator.cs:75-80</code></p>
</blockquote>
<h2 id="headless-ui-suppression">Headless UI Suppression</h2>
<p>In CI environments, the sandbox suppresses all OS-level dialogs:</p>
<ol>
<li><strong>SetErrorMode</strong> - Suppresses Win32 critical error dialogs</li>
<li><strong>WerSetFlags</strong> - Suppresses Windows Error Reporting UI</li>
<li><strong>Trace listeners</strong> - Disables <code>Debug.Assert</code> popups</li>
</ol>
<blockquote>
<p><strong>Source:</strong> <code>csharp/src/DBTools.Sandbox/HeadlessUiSuppression.cs:17-120</code></p>
</blockquote>
<p>This prevents CI builds from hanging on modal dialogs.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="dist-payload-not-found">&quot;Dist payload not found&quot;</h3>
<p>The sandbox requires a built dist payload:</p>
<pre><code class="lang-bash">bash csharp/build.sh BuildAll
</code></pre>
<h3 id="window-crashes-in-sandbox-but-works-in-revit">Window crashes in sandbox but works in Revit</h3>
<p>Check for Revit-dependent code not guarded by <code>SandboxMode.IsActive</code>:</p>
<pre><code class="lang-csharp">// Wrong - crashes in sandbox
var doc = AppRuntime.Resolve&lt;IRevitService&gt;().Document;

// Right - sandbox-safe
if (!SandboxMode.IsActive)
{
    var doc = AppRuntime.Resolve&lt;IRevitService&gt;().Document;
}
</code></pre>
<h3 id="binding-errors-in-validation">Binding errors in validation</h3>
<p>The <code>BindingErrorListener</code> will report silent WPF binding failures. Check:</p>
<ul>
<li>Missing <code>StaticResource</code> keys in XAML</li>
<li>Incorrect binding paths</li>
<li>Missing value converters</li>
</ul>
<h3 id="type-not-found-during-validation">&quot;Type not found&quot; during validation</h3>
<p>Ensure the window and ViewModel types:</p>
<ul>
<li>Have fully-qualified names in the manifest</li>
<li>Are public classes</li>
<li>Have public parameterless constructors</li>
</ul>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../architecture/sandbox-validator.html">Architecture: Sandbox Validator</a> - Detailed validation architecture</li>
<li><a href="app.html">DBTools.App</a> - How App discovers tools via manifests</li>
<li><a href="../architecture/overview.html">Tool Manifest Schema</a> - Complete manifest documentation</li>
</ul>
<h2 id="see-also">See Also</h2>
<ul>
<li><code>DbtSandboxWindowSpec</code> - Window specification model</li>
<li><code>DbtSandboxCatalog</code> - Window discovery from manifests</li>
<li><code>DbtToolManifestLoader</code> - Manifest parsing and validation</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/kirsch33/dbtools/blob/dev/csharp/wiki/developer-guide/projects/sandbox.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          DB Tools - Revit Add-in Toolkit
        </div>
      </div>
    </footer>
  </body>
</html>
